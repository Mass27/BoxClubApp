
<div class="flex justify-center mb-6">
  <button
    (click)="toggleFormulario()"
    class="w-full max-w-md bg-blue-600 text-white py-3 px-6 rounded-xl flex items-center justify-between hover:bg-blue-700 transition-all ease-in-out duration-200 shadow-lg focus:outline-none"
  >
    <span>{{ metricaId ? "Evaluar Métrica" : "Registrar Métrica" }}</span>
    <span class="text-xl">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        [ngClass]="
          showFormulario ? 'w-6 h-6 transform rotate-180' : 'w-6 h-6 transform'
        "
        class="transition-transform duration-300 ease-in-out"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M19 9l-7 7-7-7"
        />
      </svg>
    </span>
  </button>
</div>


<form
  *ngIf="showFormulario"
  [formGroup]="metricaForm"
  (ngSubmit)="onSubmit()"
  class="max-w-2xl mx-auto bg-white p-6 rounded-2xl shadow space-y-6"
>
  <h2 class="text-2xl font-semibold text-gray-800 mb-6">
    {{ metricaId ? "Evaluar Métrica" : "Registrar Métrica" }}
  </h2>

  <div *ngIf="!metricaId">
    <div class="mb-4">
      <label for="clienteId" class="block text-gray-700 font-medium mb-2"
        >Seleccionar Cliente</label
      >
      <select
        formControlName="clienteId"
        id="clienteId"
        class="w-full p-3 border border-gray-300 rounded-md bg-white text-gray-700 focus:ring-2 focus:ring-blue-500"
      >
        <option value="" disabled selected>-- Selecciona una Rutina --</option>
        <option *ngFor="let cliente of clientes" [value]="cliente._id">
          {{ cliente.nombreCompleto }}
        </option>
      </select>

    </div>

  </div>

  <div class="grid grid-cols-2 gap-6">
    <input
      formControlName="fecha"
      type="date"
      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
    />
 <div *ngIf="metricaForm.get('fecha')?.invalid && metricaForm.get('fecha')?.touched" class="text-red-600 text-sm">
      La fecha es obligatoria.
    </div>

    <input
      formControlName="pesoCorporal"
      placeholder="Peso (kg)"
      type="number"
      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
    />
 <div *ngIf="metricaForm.get('pesoCorporal')?.invalid && metricaForm.get('pesoCorporal')?.touched" class="text-red-600 text-sm">
      El peso corporal es obligatorio y debe ser mayor a 0.
    </div>
    <input
      formControlName="grasaCorporal"
      placeholder="Grasa (%)"
      type="number"
      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
    />
 <div *ngIf="metricaForm.get('grasaCorporal')?.invalid && metricaForm.get('grasaCorporal')?.touched" class="text-red-600 text-sm">
      La grasa corporal es obligatoria y debe ser mayor a 0.
    </div>
    <input
      formControlName="imc"
      placeholder="IMC"
      type="number"
      step="0.1"
      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
    />
    <div *ngIf="metricaForm.get('imc')?.invalid && metricaForm.get('imc')?.touched" class="text-red-600 text-sm">
      El IMC es obligatorio y debe ser mayor a 0.
    </div>
  </div>

  <div class="mb-4">
    <label for="rutina" class="block text-gray-700 font-medium mb-2"
      >Seleccionar Rutina</label
    >
    <select
      formControlName="rutinaActual"
      id="rutina"
      class="w-full p-3 border border-gray-300 rounded-md bg-white text-gray-700 focus:ring-2 focus:ring-blue-500"
    >
      <option value="" disabled selected>-- Selecciona una Rutina --</option>
      <option *ngFor="let rutina of rutinas" [value]="rutina._id">
        {{ rutina.nombre }}
      </option>
    </select>
     <div *ngIf="metricaForm.get('rutinaActual')?.invalid && metricaForm.get('rutinaActual')?.touched" class="text-red-600 text-sm">
      La rutina es obligatoria.
    </div>
  </div>

  <input
    formControlName="progreso"
    placeholder="Progreso"
    class="w-full p-3 border border-gray-300 rounded-lg col-span-2 focus:ring-2 focus:ring-blue-500"
  />
<div *ngIf="metricaForm.get('progreso')?.invalid && metricaForm.get('progreso')?.touched" class="text-red-600 text-sm">
      El Progreso es obligatorio.
    </div>
  <textarea
    formControlName="nota"
    placeholder="Nota"
    class="w-full p-3 border border-gray-300 rounded-lg col-span-2 focus:ring-2 focus:ring-blue-500"
  ></textarea>

  <fieldset formGroupName="medidas" class="mt-6">
    <legend class="text-lg font-semibold text-gray-700 mb-4">Medidas</legend>
    <div class="grid grid-cols-3 gap-6">
      <input
        formControlName="cintura"
        placeholder="Cintura (cm)"
        type="number"
        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
      />
      <div *ngIf="metricaForm.get('cintura')?.invalid && metricaForm.get('cintura')?.touched" class="text-red-600 text-sm">
       La cintura es obligatoria y debe ser mayor a 0.
    </div>
      <input
        formControlName="pecho"
        placeholder="Pecho (cm)"
        type="number"
        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
      />
      <div *ngIf="metricaForm.get('pecho')?.invalid && metricaForm.get('pecho')?.touched" class="text-red-600 text-sm">
       El pecho es obligatoria y debe ser mayor a 0.
    </div>
      <input
        formControlName="biceps"
        placeholder="Bíceps (cm)"
        type="number"
        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
      />
      <div *ngIf="metricaForm.get('biceps')?.invalid && metricaForm.get('biceps')?.touched" class="text-red-600 text-sm">
       El Bicep es obligatoria y debe ser mayor a 0.
    </div>
    </div>
  </fieldset>

  <button
    type="submit"
    class="w-full bg-blue-600 text-white py-3 px-6 rounded-xl hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 transition"
  >
    {{ isEditMode ? "Actualizar" : "Agregar Nueva Métrica" }}
  </button>
</form>


<hr class="my-6" />
<h3 class="text-xl font-semibold text-gray-800 mb-4">Historial de Métricas</h3>
<div
  *ngFor="let metrica of metricasHistorial"
  class="bg-white shadow-lg rounded-lg p-6 mb-4"
>
  <div class="flex justify-between items-center mb-4">
    <p class="text-lg font-medium text-gray-700">
      <strong>Fecha:</strong> {{ metrica.fecha | date : "yyyy-MM-dd" }}
    </p>
    <button
      (click)="cargarParaEditar(metrica)"
      (click)="toggleFormulario()"
      class="text-blue-600 hover:text-blue-800 focus:outline-none font-medium"
    >
      Editar
    </button>
  </div>

  <div class="grid grid-cols-2 gap-4 mb-4">
    <div>
      <p class="text-sm text-gray-500">Peso</p>
      <p class="font-semibold text-gray-700">{{ metrica.pesoCorporal }} kg</p>
    </div>
    <div>
      <p class="text-sm text-gray-500">IMC</p>
      <p class="font-semibold text-gray-700">{{ metrica.imc }}</p>
    </div>
    <div>
      <p class="text-sm text-gray-500">Grasa Corporal</p>
      <p class="font-semibold text-gray-700">{{ metrica.grasaCorporal }}%</p>
    </div>
    <div class="col-span-2">
      <p class="text-sm text-gray-500">Nota</p>
      <p class="font-semibold text-gray-700">{{ metrica.nota || "N/A" }}</p>
    </div>
  </div>
</div>
