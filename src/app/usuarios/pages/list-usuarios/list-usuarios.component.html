<h2 class="titulo-global">Listado de Clientes</h2>

<div class="search-container">
  <app-search-box
    class="app-search-box"
    (bcNombre)="buscarClientePorNombre($event)"
  ></app-search-box>
  <button class="button-agregar" routerLink="/usuarios/agregar">AGREGAR</button>
</div>

<div class="button-filtrar">
  <button
    class="button-alternar"
    [class.selected]="!mostrarInactivos && !mostrarPendientes"
    (click)="mostrarUsuarios('Activos')"
  >
    Mostrar Activos
  </button>
  <button
    class="button-alternar"
    [class.selected]="mostrarInactivos"
    (click)="mostrarUsuarios('Inactivos')"
  >
    Mostrar Inactivos
  </button>
  <button
    class="button-alternar"
    [class.selected]="mostrarPendientes"
    (click)="mostrarUsuarios('Pendientes')"
  >
    Mostrar Pendientes
  </button>
</div>
<div class="contador-clientes-activos">
  <mat-chip
    ><strong>Clientes Activos:</strong
    ><strong>{{ contadorClientesActivos }}</strong></mat-chip
  >
</div>

<!-- Botón para desplegar la bandeja de notificaciones -->
<button
  class="fixed bottom-4 right-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full shadow-lg focus:outline-none transition-all duration-300"
  (click)="toggleBandeja()"
>
  <mat-icon>notifications</mat-icon>
</button>

<!-- Bandeja de notificaciones -->
<div *ngIf="mostrarBandeja" class="fixed bottom-16 right-4 bg-white border border-gray-300 shadow-lg p-4 rounded-lg max-w-sm w-full">
  <h3 class="text-lg font-semibold text-gray-800 mb-4">Notificaciones</h3>

  <div *ngFor="let user of usuariosConTresDiasRestantes" class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 px-4 py-3 rounded-lg mb-3 shadow-sm">
    <p class="text-sm">
      <span class="font-medium">{{ user.nombreCompleto }}</span> tiene {{ user.diasRestantes }} días restantes en su plan.
    </p>
  </div>
</div>



<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-8">
  <div
    *ngFor="let item of usuariosFiltrados"
    class="bg-white rounded-2xl shadow-md hover:shadow-lg transition-shadow duration-300 p-6"
  >
    <!-- Imagen del usuario -->
     <div class="flex justify-center mb-4">
      <img
        [src]="item.imagen"
        alt="Imagen de {{ item.nombreCompleto }}"
        class="w-32 h-32 object-cover border-2 border-gray-300 shadow-sm"
      />
    </div>

    <!-- Nombre -->
    <h2 class="text-xl font-semibold text-center text-gray-800 mb-4">
      {{ item.nombreCompleto }}
    </h2>

    <!-- Información del usuario -->
    <ul class="text-sm text-gray-600 space-y-1">
      <li><strong>DNI:</strong> {{ item.identidad }}</li>
      <li><strong>Teléfono:</strong> {{ item.numeroTelefono }}</li>
      <li><strong>Correo:</strong> {{ item.correo }}</li>
      <li><strong>Fecha de Ingreso:</strong> {{ item.fechaIngreso | date }}</li>
      <li>
        <strong>Plan:</strong>
        {{ item.idPlan ? getPlanName(item.idPlan) : "Plan no encontrado" }}
      </li>
      <li><strong>Días Restantes:</strong> {{ item.diasRestantes }}</li>
    </ul>

    <!-- Estado -->
    <div
      class="mt-4 text-center font-medium py-1 rounded text-sm"
      [ngClass]="{
        'bg-green-100 text-green-700': item.estado === 'Activo',
        'bg-red-100 text-red-700': item.estado === 'Inactivo',
        'bg-yellow-100 text-yellow-700': item.estado === 'Pendiente'
      }"
    >
      {{ item.estado }}
    </div>

    <!-- Botones -->
    <div class="flex flex-col space-y-2 mt-6">
      <button
        *ngIf="isAdmin"
        (click)="asignarRutina(item._id)"
        class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg font-semibold transition"
      >
        Asignar Rutina
      </button>

      <button
        *ngIf="isAdmin"
        [routerLink]="['/usuarios/edit', item._id]"
        class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg font-semibold transition"
      >
        Editar Usuario
      </button>
    </div>
  </div>
</div>
<!-- Paginación -->
<!-- Paginación -->
<div class="flex flex-col items-center mt-8 space-y-4">

  <!-- Controles de página -->
  <div class="flex justify-center items-center gap-4">
    <button
      (click)="cargarUsuarios(1)"
      [disabled]="currentPage === 1"
      class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-sm rounded disabled:opacity-50"
    >
      Primera
    </button>

    <button
      (click)="cargarUsuarios(currentPage - 1)"
      [disabled]="currentPage === 1"
      class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-sm rounded disabled:opacity-50"
    >
      Anterior
    </button>

    <span class="text-sm font-medium">
      Página {{ currentPage }} de {{ totalPages }}
    </span>

    <button
      (click)="cargarUsuarios(currentPage + 1)"
      [disabled]="currentPage === totalPages"
      class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-sm rounded disabled:opacity-50"
    >
      Siguiente
    </button>

    <button
      (click)="cargarUsuarios(totalPages)"
      [disabled]="currentPage === totalPages"
      class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-sm rounded disabled:opacity-50"
    >
      Última
    </button>
  </div>

  <!-- Selector de ítems por página -->
  <div class="flex items-center space-x-2">
    <label class="text-sm">Items por página:</label>
    <select
      [(ngModel)]="limit"
      (change)="cargarUsuarios(1)"
      class="border px-2 py-1 rounded text-sm"
    >
      <option *ngFor="let l of [5, 10, 20, 50]" [value]="l">{{ l }}</option>
    </select>
  </div>

</div>

