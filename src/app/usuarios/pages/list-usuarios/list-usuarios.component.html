<h2 class="titulo-global">Listado de Clientes</h2>

<div class="search-container">
  <app-search-box
    class="app-search-box"
    (bcNombre)="buscarClientePorNombre($event)"
  ></app-search-box>
  <button class="button-agregar" routerLink="/usuarios/agregar">AGREGAR</button>
</div>

<div class="button-filtrar">
  <button
    class="button-alternar"
    [class.selected]="!mostrarInactivos && !mostrarPendientes"
    (click)="mostrarUsuarios('Activos')"
  >
    Mostrar Activos
  </button>
  <button
    class="button-alternar"
    [class.selected]="mostrarInactivos"
    (click)="mostrarUsuarios('Inactivos')"
  >
    Mostrar Inactivos
  </button>
  <button
    class="button-alternar"
    [class.selected]="mostrarPendientes"
    (click)="mostrarUsuarios('Pendientes')"
  >
    Mostrar Pendientes
  </button>
</div>
<div class="contador-clientes-activos">
  <mat-chip
    ><strong>Clientes Activos:</strong
    ><strong>{{ contadorClientesActivos }}</strong></mat-chip
  >
</div>

<!-- Botón para desplegar la bandeja de notificaciones -->
<button
  class="fixed bottom-4 right-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
  (click)="toggleBandeja()"
>
  <mat-icon>notifications</mat-icon>
</button>

<!-- Bandeja de notificaciones -->
<div
  *ngIf="mostrarBandeja"
  class="fixed bottom-16 right-4 bg-white border border-gray-200 shadow-lg p-4 rounded"
>
  <h3 class="text-lg font-bold mb-2">Notificaciones</h3>
  <div
    *ngFor="let user of usuariosConTresDiasRestantes"
    class="bg-yellow-200 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-2"
    role="alert"
  >
    <p class="text-sm">
      {{ user.nombreCompleto }} tiene {{ user.diasRestantes }} días restantes en
      su plan.
    </p>
  </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-8">
  <div
    class="grid-item bg-white shadow-md rounded-lg overflow-hidden hover:shadow-lg transition-shadow duration-300"
    *ngFor="let item of usuariosFiltrados"
  >
    <div class="user-card p-4">
      <div class="flex items-center justify-center mb-4">
        <img
          [src]="item.imagen"
          alt="Imagen de {{ item.nombreCompleto }}"
          class="w-24 h-24 rounded-full object-cover border-2 border-gray-300"
        />
      </div>
      <h2 class="text-lg font-bold text-center text-gray-800 mb-2">
        {{ item.nombreCompleto }}
      </h2>
      <div class="text-sm text-gray-600 space-y-1">
        <p><strong>DNI:</strong> {{ item.identidad }}</p>
        <p><strong>Teléfono:</strong> {{ item.numeroTelefono }}</p>
        <p><strong>Correo:</strong> {{ item.correo }}</p>
        <p>
          <strong>Fecha de Ingreso:</strong> {{ item.fechaIngreso | date}}
        </p>
        <p>
          <strong>Plan:</strong>
          {{ item.idPlan ? getPlanName(item.idPlan) : "Plan no encontrado" }}
        </p>
        <p><strong>Días Restantes:</strong> {{ item.diasRestantes }}</p>
      </div>
      <p
        class="mt-4 text-center font-semibold text-sm py-1 rounded"
        [ngClass]="{
          'bg-green-100 text-green-700': item.estado === 'Activo',
          'bg-red-100 text-red-700': item.estado === 'Inactivo',
          'bg-yellow-100 text-yellow-700': item.estado === 'Pendiente'
        }"
      >
        {{ item.estado }}

      </p>
      <div class="mt-4 text-center">
        <button
          *ngIf="isAdmin"
          class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors duration-300"
          (click)="asignarRutina(item._id)"
        >
          Asignar Rutina
        </button>
      </div>


      <div class="mt-4 text-center">
        <button
          *ngIf="isAdmin"
          class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition-colors duration-300"
          [routerLink]="['/usuarios/edit', item._id]"
        >
          Editar
        </button>
      </div>
    </div>
  </div>
</div>
